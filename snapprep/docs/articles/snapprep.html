<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to snapprep • snapprep</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Google analytics --><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46129458-3', 'auto');
  ga('send', 'pageview');

</script>
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">snapprep</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/snapprep.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/aws.html">Uploading SNAP dat to AWS</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-globe fa-lg"></span>
     
    SNAPverse
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://leonawicz.github.io/sv.html">Home of the verse</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Sector packages</li>
    <li>
      <a href="https://leonawicz.github.io/snapverse">snapverse</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snaplite">snaplite</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snapdata">snapdata</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snapwebs">snapwebs</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Functions packages</li>
    <li>
      <a href="https://leonawicz.github.io/snapstat">snapstat</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snapplot">snapplot</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snaplocs">snaplocs</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snapprep">snapprep</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/alfresco">alfresco</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Data packages</li>
    <li>
      <a href="https://leonawicz.github.io/snapclim">snapclim</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snapfire">snapfire</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snappoly">snappoly</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snapgrid">snapmaps</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snapdist">snapdist</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Apps &amp; docs packages</li>
    <li>
      <a href="https://leonawicz.github.io/snapapps">snapapps</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snapdash">snapdash</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snapflex">snapflex</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snapdocs">snapdocs</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Satellite packages</li>
    <li>
      <a href="https://leonawicz.github.io/rvtable">rvtable</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/apputils">apputils</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/maputils">maputils</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snaputils">snaputils</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snapmeta">snapmeta</a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/snapsite">snapsite</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://github.com/leonawicz/snapprep">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Introduction to snapprep</h1>
            
          </div>

    
    
<div class="contents">
<p>The <code>snapprep</code> R package is used by the package author/maintainer primarily to prepare and curate data sets for downstream use in other SNAP projects and R packages. It is a developer package not made for other users in general. However, this vignette documents some of the data prep pipelines facilitated by <code>snapprep</code>, which can make various types of data munging from raw/source SNAP data files to more useful, manageable and meaningful curated data sets that cater to specific projects and analysis objectives a more seamless process.</p>
<div id="climate-distributions" class="section level2">
<h2 class="hasAnchor">
<a href="#climate-distributions" class="anchor"></a>Climate distributions</h2>
<p>There is not much to show in terms of code, but this is the intent of <code>snapprep</code>. It encapsulates the heavy lifting of procedures like climate variable probability distribution modeling in package functions and the package includes standard default options for working with source data located on the SNAP network.</p>
</div>
<div id="monthly-data" class="section level2">
<h2 class="hasAnchor">
<a href="#monthly-data" class="anchor"></a>Monthly data</h2>
<p>First, you can generate a table of available combinations of climate models, CRU data, emissions scenarios (RCPs) and climate variables. On the Atlas cluster, you do not have to pass an explicit directory unless you want to override the default. The package knows where the standard outputs are stored. Note that in terms of outputs, you have to provide a directory. You will not have permissions to write to the default. Since this needs to be run on the Atlas cluster, this vignette cannot print the output for you here.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(snapprep)
x &lt;-<span class="st"> </span><span class="kw"><a href="../reference/clim_inputs_table.html">clim_inputs_table</a></span>()
x</code></pre></div>
<p>Now you are ready to extract data from SNAP’s downscaled CMIP5 Alaska/western Canada maps collection. This will take a while to run if you are planning to process every data set (every row of <code>x</code>). It will process in parallel over years using 32 CPUs on an Atlas compute node by default. The call below to <code>clim_dist_monthly</code> extracts monthly data for all years from whatever climate models (plus CRU), historical period and RCPs, and climate variables (min, mean and max temperature, and precipitation) are passed via <code>x</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">purrr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/purrr/topics/map">map</a></span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(x), <span class="op">~</span><span class="st"> </span><span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/clim_dist_monthly.html">clim_dist_monthly</a></span>(<span class="kw">slice</span>(x, .x)))</code></pre></div>
<p>This saves .rds files containing data frames of modeled probability density functions for spatial distributions of climate variables for all these source data sets. Outputs are saved to a directory containing groups of regions. Each region group contains subdirectories of related subregions. These directories contain the .rds files.</p>
<p>If it is important to keep monthly files on disk rather than annual files containing all months’ data, the step above can be followed up with <code>split_monthly_files</code>, which will split the original 12-month files into 12 single-month files and store the new structure in another directory.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/split_monthly_files.html">split_monthly_files</a></span>()</code></pre></div>
<p>The regions for which spatial distributions are estimated are taken from the 2-km level locations listed in <code>snapdef()$cells_akcan1km2km</code>, which is made by <code><a href="http://www.rdocumentation.org/packages/snapprep/topics/save_poly_cells">snapprep::save_poly_cells</a></code> and itself uses common SNAP polygons that can be found in the <code>snappoly</code> SNAPverse data package.</p>
</div>
<div id="seasonal-and-annual-data" class="section level2">
<h2 class="hasAnchor">
<a href="#seasonal-and-annual-data" class="anchor"></a>Seasonal and annual data</h2>
<p>Modeling seasonal and annual temporal resolution distributions does not require revisiting the source downscaled geotiff files. That brute force approach of aggregating the source data to seasonal and annual averages would be a waste of time and effort. The sensible approach is to estimate seasonal and annual distributions from the already estimated monthly distributions. Those outputs now become your inputs. The further you get from the source data as you continue down the processing pipeline, the faster the processing will go.</p>
<p><code>clim_dist_seasonal</code> also uses parallel processing internally. There is a one-to-one correspondence between monthly and seasonal files. Using default arguments, it is as simple as:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/clim_dist_seasonal.html">clim_dist_seasonal</a></span>()</code></pre></div>
<p>It is recommended, however, to split the processing into multiple batches by using the <code>rcp</code> and <code>variable</code> arguments:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/clim_dist_seasonal.html">clim_dist_seasonal</a></span>(<span class="dt">variable =</span> <span class="st">"tas"</span>, <span class="dt">rcp =</span> <span class="st">"rcp60"</span>)</code></pre></div>
<p>The options for <code>rcp</code> include <code>historical</code>, <code>rcp45</code>, <code>rcp60</code> and <code>rcp85</code>. The options for climate variable include <code>pr</code>, <code>tas</code>, <code>tasmin</code> and <code>tasmax</code>. Like the monthly outputs, now you have seasonal (and annual) climate variable distributions, stored (by default) in an adjacent directory with analogous structure.</p>
</div>
<div id="climate-statistics" class="section level2">
<h2 class="hasAnchor">
<a href="#climate-statistics" class="anchor"></a>Climate statistics</h2>
<p>The next step is to produce statistics from these distributions, which are useful and efficient for projects requiring specific statistics and not the need for general distributional information. The following function can be applied to both monthly and seasonal outputs. It offers internal parallel processing, again defaulting to the full 32 CPUs available on an Atlas compute node.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/clim_stats_ar5.html">clim_stats_ar5</a></span>(<span class="dt">type =</span> <span class="st">"monthly"</span>)
<span class="kw"><a href="../reference/clim_stats_ar5.html">clim_stats_ar5</a></span>(<span class="dt">type =</span> <span class="st">"seasonal"</span>)</code></pre></div>
<p>The same batch processing recommendations for seasonal distributions apply to monthly and seasonal statistics. The difference is that since all statistics for a given region are intended to be stored in a single file, the optional file filter argument for smaller batch processing jobs is <code>region_group</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/clim_stats_ar5.html">clim_stats_ar5</a></span>(<span class="dt">type =</span> <span class="st">"monthly"</span>, <span class="dt">region_group =</span> <span class="st">"FMZ regions"</span>)
<span class="kw"><a href="../reference/clim_stats_ar5.html">clim_stats_ar5</a></span>(<span class="dt">type =</span> <span class="st">"seasonal"</span>, <span class="dt">region_group =</span> <span class="st">"LCC regions"</span>)</code></pre></div>
<p>Make sure to read the documentation on these functions. You should be familiar with their arguments, including any not shown in this vignette. If you apply these functions to a large amount of data, it is also good practice to run the job in non-interactive mode via a SLURM job manager script, in case of disconnection.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#climate-distributions">Climate distributions</a></li>
      <li><a href="#monthly-data">Monthly data</a></li>
      <li><a href="#seasonal-and-annual-data">Seasonal and annual data</a></li>
      <li><a href="#climate-statistics">Climate statistics</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://leonawicz.github.io/">Matthew Leonawicz</a>, <a href="http://snap.uaf.edu/"><img src="https://raw.githubusercontent.com/leonawicz/leonawicz.github.io/master/assets/img/snap_symbol.svg?sanitize=true" height="24">  Scenarios Network for Alaska and Arctic Planning</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>

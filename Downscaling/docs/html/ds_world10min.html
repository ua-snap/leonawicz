<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title></title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style type="text/css">
/* padding for bootstrap navbar */
body {
padding-top: 50px;
padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar) */
.section h2 {
padding-top: 55px;
margin-top: -55px;
}
.section h3 {
padding-top: 55px;
margin-top: -55px;
}
/* don't use link color in navbar */
.dropdown-menu>li>a {
color: black;
}
/* some padding for disqus */
#disqus_thread {
margin-top: 45px;
}
p {
  text-align: justify;
}
img.centered {
  display: block;
  margin-left: auto;
  margin-right: auto;
}
</style>
<link rel="stylesheet" href="libs/font-awesome-4.1.0/css/font-awesome.min.css"/>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #303030; color: #cccccc; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; }
td.sourceCode { padding-left: 5px; }
pre, code { color: #cccccc; background-color: #303030; }
code > span.kw { color: #f0dfaf; } /* Keyword */
code > span.dt { color: #dfdfbf; } /* DataType */
code > span.dv { color: #dcdccc; } /* DecVal */
code > span.bn { color: #dca3a3; } /* BaseN */
code > span.fl { color: #c0bed1; } /* Float */
code > span.ch { color: #dca3a3; } /* Char */
code > span.st { color: #cc9393; } /* String */
code > span.co { color: #7f9f7f; } /* Comment */
code > span.ot { color: #efef8f; } /* Other */
code > span.al { color: #ffcfaf; } /* Alert */
code > span.fu { color: #efef8f; } /* Function */
code > span.er { color: #c3bf9f; } /* Error */
code > span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
code > span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code > span.sc { color: #dca3a3; } /* SpecialChar */
code > span.vs { color: #cc9393; } /* VerbatimString */
code > span.ss { color: #cc9393; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { } /* Variable */
code > span.cf { color: #f0dfaf; } /* ControlFlow */
code > span.op { color: #f0efd0; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code > span.at { } /* Attribute */
code > span.do { color: #7f9f7f; } /* Documentation */
code > span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code > span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code > span.in { color: #7f9f7f; font-weight: bold; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46129458-3', 'auto');
  ga('send', 'pageview');

</script>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="libs/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->





<div class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Downscaling</a>
      </div>
      <div class="navbar-collapse collapse navbar-responsive-collapse">
        <ul class="nav navbar-nav">
          <li><a href="index.html">Overview</a></li>

          <li class="dropdown">
            <a href="climatologies" class="dropdown-toggle" data-toggle="dropdown">Climatologies <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li class="dropdown-header">Main script</li>
              <li><a href="climatologies.html">climatologies.R</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">Functions</li>
              <li><a href="climPrep.html">climPrep.R</a></li>
              <li><a href="climCalc.html">climCalc.R</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">CRU 2.0</li>
              <li><a href="cru20prelimExtraction">cru20prelimExtraction.R</a></li>
            </ul>

          <li class="dropdown">
            <a href="anomalies" class="dropdown-toggle" data-toggle="dropdown">Anomalies <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li class="dropdown-header">Main script</li>
              <li><a href="anomalies.html">anomalies.R</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">Functions</li>
              <li><a href="anomPrep.html">anomPrep.R</a></li>
              <li><a href="anomCalc.html">anomCalc.R</a></li>
              <li><a href="anomCalcAsScript.html">anomCalcAsScript.R</a></li>
              <li><a href="anomParSubFunc.html">anomParSubFunc.R</a></li>
            </ul>

          <li class="dropdown">
            <a href="downscaling" class="dropdown-toggle" data-toggle="dropdown">Downscaling <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li class="dropdown-header">2-km/771-m PRISM</li>
              <li><a href="ds_prism.html">ds_prism.R</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">10-minute CRU 2.0</li>
              <li><a href="ds_world10min.html">ds_world10min.R</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">Min & Max Temperature</li>
              <li><a href="ds_minmax_temps.html">ds_minmax_temps.R</a></li>
            </ul>

          <li><a href="http://leonawicz.github.io">All Projects</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <a class="btn btn-link" href="https://github.com/leonawicz/Downscaling">
            <i class="fa fa-github fa-lg"></i>
            Github
          </a>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </div>

<div class="fluid-row" id="header">




</div>


<div id="section" class="section level2">
<h2></h2>
</div>
<div id="section-1" class="section level2">
<h2></h2>
</div>
<div id="ds_world10min.r" class="section level2">
<h2>ds_world10min.R</h2>
<p>This script downscales monthly climate anomalies geotiffs to CRU 2.0 10-minute resolution monthly climatologies, which cover the world grid less some extreme latitudes. The monthly climatologies used are technically derived climatologies which incorporate some methods that help make downscaling more robust to extreme outliers and downscaling artifacts. For this reason they are not identical to the original CRU 2.0 10-minute monthly climatologies.</p>
<p>Unlike the <code>climatologies.R</code> and <code>amomalies.R</code> which create their respective geotiffs for any of a number of different data sets, this downscaling script strictly performs downscaling to 10-minute resolution using CRU climatologies. Furthermore, though similar, the methods used in this version of downscaling are not the same as those employed when downscaling to the higher-resolution PRISM climatologies for example.</p>
<p><code>ds_world10min.R</code> is called with command line arguments by one of two SLURM scripts, <code>ds_world10min_cru.slurm</code> or <code>ds_world10min_gcm.slurm</code>.</p>
<div id="r-code" class="section level3">
<h3>R code</h3>
<div id="setup" class="section level4">
<h4>Setup</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">comargs &lt;-<span class="st"> </span>(<span class="kw">commandArgs</span>(<span class="ot">TRUE</span>))
if (!<span class="kw">length</span>(comargs)) <span class="kw">q</span>(<span class="st">&quot;no&quot;</span>) else for (z in <span class="dv">1</span>:<span class="kw">length</span>(comargs)) <span class="kw">eval</span>(<span class="kw">parse</span>(<span class="dt">text =</span> comargs[[z]]))

if (!<span class="kw">exists</span>(<span class="st">&quot;i&quot;</span>)) <span class="kw">stop</span>(<span class="st">&quot;Index variable &#39;i&#39; not passed at command line.&quot;</span>)

<span class="kw">library</span>(raster)
<span class="kw">library</span>(parallel)

climDir &lt;-<span class="st"> &quot;/Data/Base_Data/Climate/World/Climatologies/1961_1990/CRU_CL20_climatologies_historical_1961_1990&quot;</span>
b.clim.p &lt;-<span class="st"> </span><span class="kw">readAll</span>(<span class="kw">brick</span>(<span class="kw">file.path</span>(climDir, <span class="st">&quot;pr_CRU_CL20_historical_climatology_01_12_1961_1990.tif&quot;</span>)))
b.clim.t &lt;-<span class="st"> </span><span class="kw">readAll</span>(<span class="kw">brick</span>(<span class="kw">file.path</span>(climDir, <span class="st">&quot;tas_CRU_CL20_historical_climatology_01_12_1961_1990.tif&quot;</span>)))
<span class="kw">projection</span>(b.clim.t) &lt;-<span class="st"> </span><span class="kw">projection</span>(b.clim.p) &lt;-<span class="st"> &quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0&quot;</span>

anomDir &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="st">&quot;/Data/Base_Data/Climate/World/Anomalies/1961_1990_Base_Climatology&quot;</span>, 
    <span class="dt">full =</span> T)
allowed.models &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;cccma-cgcm3-1-t47&quot;</span>, <span class="st">&quot;gfdl-cm2-1&quot;</span>, <span class="st">&quot;miroc3-2-medres&quot;</span>, <span class="st">&quot;mpi-echam5&quot;</span>, 
    <span class="st">&quot;ukmo-hadcm3&quot;</span>, <span class="st">&quot;CCSM4&quot;</span>, <span class="st">&quot;GFDL-CM3&quot;</span>, <span class="st">&quot;GISS-E2-R&quot;</span>, <span class="st">&quot;IPSL-CM5A-LR&quot;</span>, <span class="st">&quot;MRI-CGCM3&quot;</span>, 
    <span class="st">&quot;CRU_TS30&quot;</span>, <span class="st">&quot;CRU_TS31&quot;</span>, <span class="st">&quot;CRU_TS32&quot;</span>)

outDir &lt;-<span class="st"> &quot;/Data/Base_Data/Climate/World/World_10min&quot;</span>

if (i &gt;<span class="st"> </span><span class="kw">length</span>(anomDir)) <span class="kw">stop</span>(<span class="st">&quot;Index variable &#39;i&#39; exceeds maximum value.&quot;</span>)

mos &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">paste0</span>(<span class="dv">0</span>, <span class="dv">1</span>:<span class="dv">9</span>), <span class="dv">10</span>:<span class="dv">12</span>)
meta &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(<span class="kw">basename</span>(anomDir[i]), <span class="st">&quot;_&quot;</span>))
grp &lt;-<span class="st"> </span>meta[<span class="dv">1</span>]
grp2 &lt;-<span class="st"> </span>if (grp ==<span class="st"> &quot;AR4&quot;</span>) <span class="st">&quot;AR4_CMIP3_models&quot;</span> else if (grp ==<span class="st"> &quot;AR5&quot;</span>) <span class="st">&quot;AR5_CMIP5_models&quot;</span> else grp
scenario &lt;-<span class="st"> </span>meta[<span class="dv">4</span>]
period.scenario &lt;-<span class="st"> </span>if (scenario ==<span class="st"> &quot;historical&quot;</span>) <span class="kw">c</span>(scenario, <span class="st">&quot;&quot;</span>) else <span class="kw">c</span>(<span class="st">&quot;projected&quot;</span>, 
    scenario)
models &lt;-<span class="st"> </span><span class="kw">list.files</span>(anomDir[i])
models &lt;-<span class="st"> </span>models[models %in%<span class="st"> </span>allowed.models]</code></pre></div>
</div>
<div id="processing-function" class="section level4">
<h4>Processing function</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Processing function</span>
f &lt;-<span class="st"> </span>function(j, i, <span class="dt">par.by.month =</span> <span class="ot">FALSE</span>, anomDir, outDir, b.clim.t, b.clim.p) {
    if (par.by.month) {
        mo &lt;-<span class="st"> </span>j
        jj &lt;-<span class="st"> </span>j &lt;-<span class="st"> </span><span class="dv">1</span>
    } else {
        mo &lt;-<span class="st"> </span><span class="dv">1</span>:<span class="dv">12</span>
        jj &lt;-<span class="st"> </span><span class="kw">length</span>(models)
    }
    for (k in mo) {
        r.clim.t &lt;-<span class="st"> </span><span class="kw">subset</span>(b.clim.t, k)
        r.clim.p &lt;-<span class="st"> </span><span class="kw">subset</span>(b.clim.p, k)
        <span class="co"># Read temp and precip (two) annual time series multiband tif files for</span>
        <span class="co"># given anomalies directory, model, and month</span>
        pat.t &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;^tas.*._&quot;</span>, mos[k], <span class="st">&quot;_.*.tif$&quot;</span>)
        pat.p &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;^pr.*._&quot;</span>, mos[k], <span class="st">&quot;_.*.tif$&quot;</span>)
        file.t &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="kw">file.path</span>(anomDir[i], models[j]), <span class="dt">pattern =</span> pat.t, 
            <span class="dt">full =</span> T)
        file.p &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="kw">file.path</span>(anomDir[i], models[j]), <span class="dt">pattern =</span> pat.p, 
            <span class="dt">full =</span> T)
        b.anom.t &lt;-<span class="st"> </span><span class="kw">brick</span>(file.t)
        b.anom.p &lt;-<span class="st"> </span><span class="kw">brick</span>(file.p)
        if (<span class="kw">xmin</span>(b.anom.t) &lt;<span class="st"> </span><span class="dv">0</span> &amp;<span class="st"> </span><span class="kw">xmax</span>(b.anom.t) &lt;<span class="st"> </span><span class="dv">360</span>) 
            b.anom.t &lt;-<span class="st"> </span><span class="kw">extend</span>(b.anom.t, <span class="kw">c</span>(<span class="kw">xmin</span>(b.anom.t), <span class="kw">xmax</span>(b.anom.t) +<span class="st"> </span>
<span class="st">                </span><span class="kw">res</span>(b.anom.t)[<span class="dv">1</span>], <span class="kw">ymin</span>(b.anom.t), <span class="kw">ymax</span>(b.anom.t)))  <span class="co"># slight adjustments for some files to avoid erroneous regions of NAs following interpolation</span>
        if (<span class="kw">xmin</span>(b.anom.t) &gt;<span class="st"> </span><span class="dv">0</span> |<span class="st"> </span><span class="kw">xmax</span>(b.anom.t) &lt;<span class="st"> </span><span class="dv">360</span>) 
            <span class="kw">stop</span>(<span class="st">&quot;Source raster brick files require direct investigation of extent values.&quot;</span>)
        if (<span class="kw">xmin</span>(b.anom.p) &lt;<span class="st"> </span><span class="dv">0</span> &amp;<span class="st"> </span><span class="kw">xmax</span>(b.anom.p) &lt;<span class="st"> </span><span class="dv">360</span>) 
            b.anom.p &lt;-<span class="st"> </span><span class="kw">extend</span>(b.anom.p, <span class="kw">c</span>(<span class="kw">xmin</span>(b.anom.p), <span class="kw">xmax</span>(b.anom.p) +<span class="st"> </span>
<span class="st">                </span><span class="kw">res</span>(b.anom.p)[<span class="dv">1</span>], <span class="kw">ymin</span>(b.anom.p), <span class="kw">ymax</span>(b.anom.p)))  <span class="co"># slight adjustments for some files to avoid erroneous regions of NAs following interpolation</span>
        if (<span class="kw">xmin</span>(b.anom.p) &gt;<span class="st"> </span><span class="dv">0</span> |<span class="st"> </span><span class="kw">xmax</span>(b.anom.p) &lt;<span class="st"> </span><span class="dv">360</span>) 
            <span class="kw">stop</span>(<span class="st">&quot;Source raster brick files require direct investigation of extent values.&quot;</span>)
        isCRU &lt;-<span class="st"> </span><span class="kw">substr</span>(models[j], <span class="dv">1</span>, <span class="dv">3</span>) ==<span class="st"> &quot;CRU&quot;</span>
        file.year.ind &lt;-<span class="st"> </span>if (isCRU) 
            <span class="dv">7</span>:<span class="dv">8</span> else <span class="dv">9</span>:<span class="dv">10</span>
        yrs &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">substr</span>(<span class="kw">unlist</span>(<span class="kw">strsplit</span>(<span class="kw">basename</span>(file.t), <span class="st">&quot;_&quot;</span>))[file.year.ind], 
            <span class="dv">1</span>, <span class="dv">4</span>))
        yrs &lt;-<span class="st"> </span><span class="kw">seq</span>(yrs[<span class="dv">1</span>], yrs[<span class="dv">2</span>])
        <span class="kw">dir.create</span>(outDir.t &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;//&quot;</span>, <span class="st">&quot;/&quot;</span>, <span class="kw">file.path</span>(outDir, period.scenario[<span class="dv">1</span>], 
            grp2, period.scenario[<span class="dv">2</span>], models[j], <span class="st">&quot;tas&quot;</span>)), <span class="dt">recur =</span> T, <span class="dt">showWarnings =</span> F)
        <span class="kw">dir.create</span>(outDir.p &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;//&quot;</span>, <span class="st">&quot;/&quot;</span>, <span class="kw">file.path</span>(outDir, period.scenario[<span class="dv">1</span>], 
            grp2, period.scenario[<span class="dv">2</span>], models[j], <span class="st">&quot;pr&quot;</span>)), <span class="dt">recur =</span> T, <span class="dt">showWarnings =</span> F)
        <span class="co"># Downscale anomalies and combine with CRU 2.0 climatology, write anual .tif</span>
        <span class="co"># files</span>
        nc &lt;-<span class="st"> </span><span class="kw">ncol</span>(b.anom.t)
        for (h in <span class="dv">1</span>:<span class="kw">nlayers</span>(b.anom.t)) {
            r.anom.t &lt;-<span class="st"> </span><span class="kw">subset</span>(b.anom.t, h)
            r.anom.p &lt;-<span class="st"> </span><span class="kw">subset</span>(b.anom.p, h)
            if (h ==<span class="st"> </span><span class="dv">1</span> &amp;<span class="st"> </span><span class="kw">xmin</span>(r.anom.t) &lt;<span class="st"> </span><span class="dv">0</span> &amp;<span class="st"> </span><span class="kw">all</span>(<span class="kw">is.na</span>(r.anom.t[nc]))) 
                fill.last.col &lt;-<span class="st"> </span><span class="ot">TRUE</span> else fill.last.col &lt;-<span class="st"> </span><span class="ot">FALSE</span>  <span class="co"># If TRUE, then TRUE for all h and both tas and pr</span>
            if (fill.last.col) {
                <span class="co"># Last row is the same as first row</span>
                r.anom.t[, nc] &lt;-<span class="st"> </span>r.anom.t[, <span class="dv">1</span>]
                r.anom.p[, nc] &lt;-<span class="st"> </span>r.anom.p[, <span class="dv">1</span>]
            }
            r.new.t &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">mask</span>(<span class="kw">resample</span>(r.anom.t, r.clim.t), r.clim.t) +<span class="st"> </span>
<span class="st">                </span>r.clim.t, <span class="dv">1</span>)
            r.new.p &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">mask</span>(<span class="kw">resample</span>(r.anom.p, r.clim.p), r.clim.p) *<span class="st"> </span>
<span class="st">                </span>r.clim.p)
            <span class="kw">projection</span>(r.new.t) &lt;-<span class="st"> </span><span class="kw">projection</span>(r.new.p) &lt;-<span class="st"> &quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs +towgs84=0,0,0&quot;</span>
            <span class="kw">names</span>(r.new.t) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;tas_mean_C&quot;</span>, grp, models[j], scenario, 
                mos[k], yrs[h], <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)
            <span class="kw">names</span>(r.new.p) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;pr_total_mm&quot;</span>, grp, models[j], scenario, 
                mos[k], yrs[h], <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)
            if (isCRU) {
                <span class="kw">names</span>(r.new.t) &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;CRU_CRU_&quot;</span>, <span class="st">&quot;CRU_&quot;</span>, <span class="kw">names</span>(r.new.t))
                <span class="kw">names</span>(r.new.p) &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;CRU_CRU_&quot;</span>, <span class="st">&quot;CRU_&quot;</span>, <span class="kw">names</span>(r.new.p))
            }
            <span class="kw">print</span>(<span class="kw">paste0</span>(outDir.t, <span class="st">&quot;/&quot;</span>, <span class="kw">names</span>(r.new.t), <span class="st">&quot;.tif&quot;</span>))
            <span class="kw">writeRaster</span>(r.new.t, <span class="kw">paste0</span>(outDir.t, <span class="st">&quot;/&quot;</span>, <span class="kw">names</span>(r.new.t), <span class="st">&quot;.tif&quot;</span>), 
                <span class="dt">datatype =</span> <span class="st">&quot;FLT4S&quot;</span>, <span class="dt">options =</span> <span class="st">&quot;COMPRESS=LZW&quot;</span>, <span class="dt">overwrite =</span> T)
            <span class="kw">writeRaster</span>(r.new.p, <span class="kw">paste0</span>(outDir.p, <span class="st">&quot;/&quot;</span>, <span class="kw">names</span>(r.new.p), <span class="st">&quot;.tif&quot;</span>), 
                <span class="dt">datatype =</span> <span class="st">&quot;FLT4S&quot;</span>, <span class="dt">options =</span> <span class="st">&quot;COMPRESS=LZW&quot;</span>, <span class="dt">overwrite =</span> T)
            <span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;######## Model&quot;</span>, j, <span class="st">&quot;of&quot;</span>, jj, <span class="st">&quot;| Month&quot;</span>, k, <span class="st">&quot;of 12 | Year&quot;</span>, 
                h, <span class="st">&quot;of&quot;</span>, <span class="kw">nlayers</span>(b.anom.t), <span class="st">&quot;########&quot;</span>))
        }
    }
    <span class="kw">return</span>()
}</code></pre></div>
</div>
<div id="run-downscaling" class="section level4">
<h4>Run downscaling</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Run</span>
if (<span class="kw">exists</span>(<span class="st">&quot;month.index&quot;</span>) &amp;&amp;<span class="st"> </span><span class="kw">all</span>(<span class="dv">1</span>:<span class="dv">12</span> %in%<span class="st"> </span>month.index)) {
    <span class="kw">mclapply</span>(month.index, f, <span class="dt">i =</span> i, <span class="dt">par.by.month =</span> <span class="ot">TRUE</span>, <span class="dt">anomDir =</span> anomDir, 
        <span class="dt">outDir =</span> outDir, <span class="dt">b.clim.t =</span> b.clim.t, <span class="dt">b.clim.p =</span> b.clim.p, <span class="dt">mc.cores =</span> <span class="dv">12</span>)
} else <span class="kw">mclapply</span>(<span class="dv">1</span>:<span class="kw">length</span>(models), f, <span class="dt">i =</span> i, <span class="dt">anomDir =</span> anomDir, <span class="dt">outDir =</span> outDir, 
    <span class="dt">b.clim.t =</span> b.clim.t, <span class="dt">b.clim.p =</span> b.clim.p, <span class="dt">mc.cores =</span> <span class="kw">min</span>(<span class="kw">length</span>(models), 
        <span class="dv">32</span>))</code></pre></div>
</div>
</div>
</div>

<!-- some extra javascript for older browsers -->
<script type="text/javascript" src="libs/polyfill.js"></script>
<script>
  // manage active state of menu based on current page
  $(document).ready(function () {
  
    // active menu
    href = window.location.pathname
    href = href.substr(href.lastIndexOf('/') + 1)
    $('a[href="' + href + '"]').parent().addClass('active');
    
    // manage active menu header
    if (href.startsWith('authoring_'))
      $('a[href="' + 'authoring' + '"]').parent().addClass('active');
    else if (href.endsWith('_format.html'))
      $('a[href="' + 'formats' + '"]').parent().addClass('active');
    else if (href.startsWith('developer_'))
      $('a[href="' + 'developer' + '"]').parent().addClass('active');
	  
  });
</script>



</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>


</body>
</html>

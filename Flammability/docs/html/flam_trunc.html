<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<title></title>

<script src="libs/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.1/css/flatly.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.1/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/respond.min.js"></script>
<style type="text/css">
/* padding for bootstrap navbar */
body {
padding-top: 50px;
padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar) */
.section h2 {
padding-top: 55px;
margin-top: -55px;
}
.section h3 {
padding-top: 55px;
margin-top: -55px;
}
/* don't use link color in navbar */
.dropdown-menu>li>a {
color: black;
}
/* some padding for disqus */
#disqus_thread {
margin-top: 45px;
}
p {
  text-align: justify;
}
img.centered {
  display: block;
  margin-left: auto;
  margin-right: auto;
}
</style>
<link rel="stylesheet" href="libs/font-awesome-4.1.0/css/font-awesome.min.css"/>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #303030; color: #cccccc; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; }
td.sourceCode { padding-left: 5px; }
pre, code { color: #cccccc; background-color: #303030; }
code > span.kw { color: #f0dfaf; }
code > span.dt { color: #dfdfbf; }
code > span.dv { color: #dcdccc; }
code > span.bn { color: #dca3a3; }
code > span.fl { color: #c0bed1; }
code > span.ch { color: #dca3a3; }
code > span.st { color: #cc9393; }
code > span.co { color: #7f9f7f; }
code > span.ot { color: #efef8f; }
code > span.al { color: #ffcfaf; }
code > span.fu { color: #efef8f; }
code > span.er { color: #c3bf9f; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46129458-3', 'auto');
  ga('send', 'pageview');

</script>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img { 
  max-width:100%; 
  height: auto; 
}
</style>
<div class="container-fluid main-container">

<div class="navbar navbar-default navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Flammability</a>
      </div>
      <div class="navbar-collapse collapse navbar-responsive-collapse">
        <ul class="nav navbar-nav">
          <li><a href="index.html">Overview</a></li>

          <li class="dropdown">
            <a href="data-prep" class="dropdown-toggle" data-toggle="dropdown">Data Prep <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="clim_prep.html">Climate data prep</a></li>
              <li><a href="clim_resample_2km_1km.html">clim_resample_2km_1km.R</a></li>
              <li><a href="clim_1km_clip2ak.html">clim_1km_clip2ak.R</a></li>
              <li><a href="tpByVeg_CRU32.html">tpByVeg_CRU32.R</a></li>
              <li><a href="tpByVeg_CMIP5.html">tpByVeg_CMIP5.R</a></li>
              <li><a href="tpByVeg_plots.html">tpByVeg_plots.R</a></li>
            </ul>

          <li class="dropdown">
            <a href="gbm-flammability" class="dropdown-toggle" data-toggle="dropdown">GBM Flammability <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li class="dropdown-header">GBM Modeling</li>
              <li><a href="baByVeg_historical.html">baByVeg_historical.R</a></li>
              <li><a href="gbm_modeling_flammability.html">gbm_modeling_flammability.R</a></li>
              <li><a href="gbm_modeling_lightning.html">gbm_modeling_lightning.R</a></li>
              <li><a href="gbm_lightning_coefficients.html">gbm_lightning_coefficients.R</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">Flammability maps</li>
              <li><a href="gbm_flam_prep.html">gbm_flam_prep.R</a></li>
              <li><a href="gbm_flam_maps.html">gbm_flam_maps.R</a></li>
              <li><a href="gbm_flam_maps2.html">gbm_flam_maps2.R</a></li>
              <li><a href="gbm_flam_comparisons.html">gbm_flam_comparisons.R</a></li>
              <li><a href="flam_dist.html">flam_dist.R</a></li>
              <li><a href="flam_trunc.html">flam_trunc.R</a></li>
              <li><a href="FlammabilityMapMultipliers.html">FlammabilityMapMultipliers.R</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">ALFRESCO prep</li>
              <li><a href="duplicate_flam_maps.html">duplicate_flam_maps.R</a></li>
              <li><a href="alf_gcmRuns_inputPrep.html">alf_gcmRuns_inputPrep.R</a></li>
            </ul>

          <li class="dropdown">
            <a href="alfresco" class="dropdown-toggle" data-toggle="dropdown">ALFRESCO <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li class="dropdown-header">Main scripts</li>
              <li><a href="AlfrescoCalibration.html">AlfrescoCalibration.R</a></li>
              <li><a href="AlfrescoFRP.html">AlfrescoFRP.R</a></li>
              <li><a href="fsByVeg.html">fsByVeg.R</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">Supporting scripts</li>
              <li><a href="obs_fire_setup.html">obs_fire_setup.R</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">Functions</li>
              <li><a href="histPrep.html">histPrep.R</a></li>
              <li><a href="fireSizePlot.html">fireSizePlot.R</a></li>
              <li><a href="AByearPlot.html">AByearPlot.R</a></li>
              <li><a href="CABvsFSPlot.html">CABvsFSPlot.R</a></li>
              <li><a href="CABvsTimePlot.html">CABvsTimePlot.R</a></li>
            </ul>

          <li class="dropdown">
            <a href="statistics" class="dropdown-toggle" data-toggle="dropdown">Statistics <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li class="dropdown-header">Fire size distributions</li>
              <li><a href="fs_eda1.html">EDA: fire samples</a></li>
              <li><a href="fs_eda2.html">EDA: Noatak shrub fire</a></li>
              <li><a href="fs_eda3.html">EDA: statewide forest fire</a></li>
              <li class="divider"></li>
              <li><a href="fs_mle1.html">MLE: setup</a></li>
              <li><a href="fs_mle2.html">MLE: Noatak shrub fire</a></li>
              <li><a href="fs_mle3.html">MLE: statewide forest fire</a></li>
            </ul>

          <li class="dropdown">
            <a href="apps" class="dropdown-toggle" data-toggle="dropdown">Apps <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li class="dropdown-header">ALFRESCO launcher</li>
              <li><a href="appcode_alf_global.html">global.R</a></li>
              <li><a href="appcode_alf_ui.html">ui.R</a></li>
              <li><a href="appcode_alf_server.html">server.R</a></li>
              <li><a href="appcode_alf_sidebar.html">sidebar.R</a></li>
              <li><a href="appcode_alf_reactives.html">reactives.R</a></li>
              <li><a href="appcode_alf_about.html">about.R</a></li>
              <li class="divider"></li>
              <li class="dropdown-header">Results app</li>
              <li><a href="appcode_frp_ui.html">ui.R</a></li>
              <li><a href="appcode_frp_server.html">server.R</a></li>
              <li><a href="appcode_frp_sidebar.html">sidebar.R</a></li>
              <li><a href="appcode_frp_app.html">app.R</a></li>
              <li><a href="appcode_frp_reactives.html">reactives.R</a></li>
              <li><a href="appcode_frp_plotFunctions.html">plotFunctions.R</a></li>
              <li><a href="appcode_frp_about.html">about.R</a></li>
            </ul>

          <li><a href="https://leonawicz.github.io">All Projects</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <a class="btn btn-link" href="https://github.com/leonawicz/Flammability">
            <i class="fa fa-github fa-lg"></i>
            Github
          </a>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </div>



<div id="section" class="section level2">
<h2></h2>
</div>
<div id="section-1" class="section level2">
<h2></h2>
</div>
<div id="truncation-of-flammability-distributions" class="section level2">
<h2>Truncation of flammability distributions</h2>
<p>Flammability distributions in each map layer are trimmed at a lower and upper bound. Truncations are unique to each vegetation classâ€™ flammability distribution. Bounds are the critical values pertaining to the 10th and 90th percentiles of the global flammability distribution. The global distribution refers to the distribution of flammability values through time (1950 - 2013) and across space for an individual vegetation class.</p>
<p>Lower and upper bounds for each vegetation class can be seen in the code below and are based on explorations of the distributions carried out in the <code>flam_dist.R</code> script. The distribution of the aggregate CAVM tundra class, which combines shrub, graminoid, and wetland tundra, is also trimmed with respect to its global 10th and 90th percentiles.</p>
<div id="r-code" class="section level3">
<h3>R code</h3>
<pre class="sourceCode r"><code class="sourceCode r">comargs &lt;-<span class="st"> </span>(<span class="kw">commandArgs</span>(<span class="ot">TRUE</span>))
if (!<span class="kw">length</span>(comargs)) <span class="kw">q</span>(<span class="st">&quot;no&quot;</span>) else for (z in <span class="dv">1</span>:<span class="kw">length</span>(comargs)) <span class="kw">eval</span>(<span class="kw">parse</span>(<span class="dt">text =</span> comargs[[z]]))

if (!<span class="kw">exists</span>(<span class="st">&quot;period&quot;</span>)) <span class="kw">stop</span>(<span class="st">&quot;Argument &#39;period&#39; not passed at command line.&quot;</span>)
if (!<span class="kw">exists</span>(<span class="st">&quot;model&quot;</span>)) <span class="kw">stop</span>(<span class="st">&quot;Argument &#39;model&#39; not passed at command line.&quot;</span>)
if (!(period %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;historical&quot;</span>, <span class="st">&quot;rcp45&quot;</span>, <span class="st">&quot;rcp60&quot;</span>, <span class="st">&quot;rcp85&quot;</span>))) <span class="kw">stop</span>(<span class="st">&quot;Invalid period specified.&quot;</span>)
if (!(model %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;CRU32&quot;</span>, <span class="st">&quot;CCSM4&quot;</span>, <span class="st">&quot;GFDL-CM3&quot;</span>, <span class="st">&quot;GISS-E2-R&quot;</span>, <span class="st">&quot;IPSL-CM5A-LR&quot;</span>, 
    <span class="st">&quot;MRI-CGCM3&quot;</span>))) <span class="kw">stop</span>(<span class="st">&quot;Invalid data set specified.&quot;</span>)
if (!<span class="kw">exists</span>(<span class="st">&quot;samples&quot;</span>)) samples &lt;-<span class="st"> </span><span class="ot">TRUE</span>
if (!<span class="kw">exists</span>(<span class="st">&quot;mapset&quot;</span>)) <span class="kw">stop</span>(<span class="st">&quot;Argument &#39;mapset&#39; not passed at command line.&quot;</span>)
if (<span class="kw">substr</span>(mapset, <span class="dv">1</span>, <span class="dv">1</span>) ==<span class="st"> &quot;3&quot;</span>) gbm &lt;-<span class="st"> </span><span class="dv">3</span> else gbm &lt;-<span class="st"> </span><span class="dv">5</span>

<span class="co"># 10th and 90th percentiles of the flammability distributions across space</span>
<span class="co"># and through time, by vegetation class</span>
q.cavm &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.1372</span>, <span class="fl">0.1487</span>)
q.shrub &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.1364</span>, <span class="fl">0.1397</span>)
q.gram &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.1363</span>, <span class="fl">0.1427</span>)
q.wet &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.1364</span>, <span class="fl">0.1399</span>)
q.alp &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.1373</span>, <span class="fl">0.141</span>)
q.for &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.1566</span>, <span class="fl">0.2694</span>)

verDir &lt;-<span class="st"> </span>if (samples) <span class="st">&quot;samples_based&quot;</span> else <span class="st">&quot;means_based&quot;</span>
<span class="kw">setwd</span>(<span class="kw">file.path</span>(<span class="st">&quot;/workspace/UA/mfleonawicz/leonawicz/projects/Flammability/data/gbmFlammability&quot;</span>, 
    verDir, period, model, mapset))
<span class="kw">dir.create</span>(outDir &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;../&quot;</span>, mapset, <span class="st">&quot;_cavmDistTrunc&quot;</span>), <span class="dt">showWarnings =</span> <span class="ot">FALSE</span>)

<span class="kw">library</span>(raster)
<span class="kw">library</span>(parallel)

files &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.tif$&quot;</span>)
yrs &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">gsub</span>(<span class="st">&quot;gbm.flamm_&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">.tif&quot;</span>, <span class="st">&quot;&quot;</span>, files)))
files &lt;-<span class="st"> </span>files[<span class="kw">order</span>(yrs)]
yrs &lt;-<span class="st"> </span>yrs[<span class="kw">order</span>(yrs)]

r.veg &lt;-<span class="st"> </span><span class="kw">readAll</span>(<span class="kw">raster</span>(<span class="st">&quot;../../../../../alf2005.cavm.merged.030212.tif&quot;</span>))
noa.shp &lt;-<span class="st"> </span><span class="kw">shapefile</span>(<span class="st">&quot;/big_scratch/mfleonawicz/Alf_Files_20121129/noa_basin2/Noa_basin2&quot;</span>)
ind.cavm &lt;-<span class="st"> </span><span class="kw">which</span>(r.veg[] &gt;=<span class="st"> </span><span class="dv">5</span>)
ind.shrub &lt;-<span class="st"> </span><span class="kw">which</span>(r.veg[] ==<span class="st"> </span><span class="dv">5</span>)
ind.gram &lt;-<span class="st"> </span><span class="kw">which</span>(r.veg[] ==<span class="st"> </span><span class="dv">6</span>)
ind.wet &lt;-<span class="st"> </span><span class="kw">which</span>(r.veg[] ==<span class="st"> </span><span class="dv">7</span>)
ind.alp &lt;-<span class="st"> </span><span class="kw">which</span>(r.veg[] ==<span class="st"> </span><span class="dv">1</span>)
ind.for &lt;-<span class="st"> </span><span class="kw">which</span>(r.veg[] ==<span class="st"> </span><span class="dv">2</span> |<span class="st"> </span>r.veg[] ==<span class="st"> </span><span class="dv">3</span> |<span class="st"> </span>r.veg[] ==<span class="st"> </span><span class="dv">4</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">f &lt;-<span class="st"> </span>function(i, outDir, files, gbm, ...) {
    
    func_trunc &lt;-<span class="st"> </span>function(x, q, ind) {
        ind &lt;-<span class="st"> </span><span class="kw">intersect</span>(ind, <span class="kw">which</span>(!<span class="kw">is.na</span>(x[])))
        x[ind][x[ind] &lt;<span class="st"> </span>q[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="dv">0</span>  <span class="co">#q[1]</span>
        x[ind][x[ind] &gt;<span class="st"> </span>q[<span class="dv">2</span>]] &lt;-<span class="st"> </span>q[<span class="dv">2</span>]
        x
    }
    
    r &lt;-<span class="st"> </span><span class="kw">raster</span>(files[i])
    if (gbm ==<span class="st"> </span><span class="dv">3</span>) 
        r &lt;-<span class="st"> </span><span class="kw">func_trunc</span>(r, q.cavm, ind.cavm)
    if (gbm ==<span class="st"> </span><span class="dv">5</span>) {
        r &lt;-<span class="st"> </span><span class="kw">func_trunc</span>(r, q.shrub, ind.shrub)
        r &lt;-<span class="st"> </span><span class="kw">func_trunc</span>(r, q.gram, ind.gram)
        r &lt;-<span class="st"> </span><span class="kw">func_trunc</span>(r, q.wet, ind.wet)
    }
    <span class="kw">writeRaster</span>(r, <span class="kw">file.path</span>(outDir, files[i]), <span class="dt">datatype =</span> <span class="st">&quot;FLT4S&quot;</span>, <span class="dt">overwrite =</span> T)
    <span class="kw">print</span>(i)
}

<span class="co"># @knit run</span>
<span class="kw">mclapply</span>(<span class="dv">1</span>:<span class="kw">length</span>(files), f, <span class="dt">outDir =</span> outDir, <span class="dt">files =</span> files, <span class="dt">gbm =</span> gbm, <span class="dt">mc.cores =</span> <span class="dv">32</span>)</code></pre>
</div>
</div>

<!-- some extra javascript for older browsers -->
<script type="text/javascript" src="libs/polyfill.js"></script>
<script>
  // manage active state of menu based on current page
  $(document).ready(function () {
  
    // active menu
    href = window.location.pathname
    href = href.substr(href.lastIndexOf('/') + 1)
    $('a[href="' + href + '"]').parent().addClass('active');
    
    // manage active menu header
    if (href.startsWith('authoring_'))
      $('a[href="' + 'authoring' + '"]').parent().addClass('active');
    else if (href.endsWith('_format.html'))
      $('a[href="' + 'formats' + '"]').parent().addClass('active');
    else if (href.startsWith('developer_'))
      $('a[href="' + 'developer' + '"]').parent().addClass('active');
	  
  });
</script>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>


</body>
</html>
